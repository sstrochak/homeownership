---
title: ""
subtitle: ""
author: ""
date: "`r format(Sys.time(), '%B %d, %Y %H:%M')`"
output:
  html_document:
    number_sections: false
    self_contained: TRUE
    code_folding: show
    toc: TRUE
    toc_float: TRUE
    css: www/web_report.css
    editor_options:
      chunk_output_type: console
---

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato" />

![](www/images/urban-institute-logo.png)


```{r rmarkdown-setup, echo = FALSE}
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)

options(scipen = 999)

```

# Measuring homeownership with the ACS

## Set up

Load libraries

```{r lib}
library(tidyverse)
library(readxl)
library(urbnthemes)
library(tidycensus)

set_urbn_defaults("print")
```

## Get historical data 

We will use `library(tidycensus)` to get a time series of homeownership rates and margins of error.

```{r tidycensus}

acs_vars <- load_variables(year = 2017, 
                           dataset = "acs1")

acs <- map_df(2012:2017, ~ mutate(get_acs(geography = "US",
                                 year = .x,
                                 survey = "acs1",
                                 variable = "B25003_002",
                                 summary_var = "B25003_001"),
                                 year = .x))

acs <- acs %>% 
  mutate(date = as.Date(paste0(year, "-12-01")),
         horate = estimate / summary_est,
         horate_low = (estimate - moe) / summary_est,
         horate_high = (estimate + moe) / summary_est)

```



## Analyze series

Plot the series over time.

```{r time-series}

ggplot(data = acs, mapping = aes(date, horate)) +
  geom_line() +
  scale_y_continuous(labels = scales::percent) +
  labs(x = NULL, y = "Homeownership rate",
       title = "Homeownership Rate",
       subtitle = "As measured by the American Community Survey")

```

Add error bars.
```{r plot-error}

ggplot(data = acs, mapping = aes(date, horate)) +
  geom_errorbar(aes(ymin = horate_low, ymax = horate_high),
                color = "#6f6f6f") +
  geom_line() +
  scale_y_continuous(labels = scales::percent) +
  labs(x = NULL, y = "Homeownership rate",
       title = "Homeownership Rate",
       subtitle = "As measured by the American Community Survey")

```

Shade the 90% confidence interval.

```{r plot-ribbon}
ggplot(data = acs, mapping = aes(date, horate)) +
  geom_ribbon(aes(ymin = horate_low, ymax = horate_high),
                fill = "#6f6f6f", alpha = .5) +
  geom_line() +
  scale_y_continuous(labels = scales::percent) +
  labs(x = NULL, y = "Homeownership rate",
       title = "Homeownership Rate",
       subtitle = "As measured by the American Community Survey")
```